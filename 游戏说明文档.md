# 幸存者游戏 - 类函数说明与游戏规则

## 一、类函数实现效果

### 1. SurvivorGame 类

**核心功能**：游戏的主窗口类，负责管理整个游戏的运行、更新和渲染。

#### 主要函数：
- `SurvivorGame(QWidget *parent = nullptr)` - 构造函数，初始化游戏场景、视图、计时器和游戏状态
- `initGame()` - 初始化游戏元素，包括地图、玩家和HUD
- `keyPressEvent(QKeyEvent *event)` - 处理键盘按下事件，控制角色移动和游戏退出
- `keyReleaseEvent(QKeyEvent *event)` - 处理键盘释放事件
- `mousePressEvent(QMouseEvent *event)` - 处理鼠标点击事件，实现射击功能
- `updateGame()` - 游戏主循环，更新所有游戏元素的状态
- `spawnEnemy()` - 随机生成敌人，每波增加生成数量和速度
- `checkCollisions()` - 检测所有碰撞（子弹-敌人、敌人-玩家、玩家-物品）
- `drawHUD()` - 绘制游戏界面，显示分数、生命值、波次和弹药
- `endGame()` - 处理游戏结束逻辑，显示最终分数

### 2. Player 类

**核心功能**：控制玩家角色的移动、射击和状态管理。

#### 主要函数：
- `Player(QGraphicsItem *parent = nullptr)` - 构造函数，初始化玩家属性
- `loadSprite()` - 加载玩家图像（当前使用绘制的图形代替）
- `updateMovement(bool keys[])` - 根据按键状态更新玩家位置，处理边界限制
- `rotateToMouse(const QPointF &targetPos)` - 旋转玩家朝向鼠标位置
- `shoot(const QPointF &targetPos)` - 发射子弹，消耗弹药，控制射速
- `takeDamage(int damage)` - 处理受伤逻辑，减少生命值，添加受伤特效
- `addHealth(int amount)` - 增加生命值，不超过最大值
- `addAmmo(int amount)` - 增加弹药数量

### 3. Enemy 类

**核心功能**：控制敌人的行为，包括追踪玩家、受伤和死亡。

#### 主要函数：
- `Enemy(Player *target, QGraphicsItem *parent = nullptr)` - 构造函数，设置目标和初始属性
- `loadSprite()` - 加载敌人图像（当前使用绘制的图形代替）
- `update()` - 更新敌人状态，控制移动
- `moveTowardsTarget()` - 计算并移动向玩家方向
- `takeDamage(int damage)` - 处理敌人受伤逻辑，死亡时掉落物品
- `dropItem()` - 随机掉落游戏物品（血包、弹药包或速度提升）

### 4. Bullet 类

**核心功能**：处理子弹的飞行、碰撞检测和生命周期。

#### 主要函数：
- `Bullet(int damage, QGraphicsItem *parent = nullptr)` - 构造函数，设置子弹伤害值
- `loadSprite()` - 加载子弹图像（当前使用绘制的图形代替）
- `setDirection(qreal dx, qreal dy)` - 设置子弹飞行方向
- `update()` - 更新子弹位置，检查是否超出屏幕边界或生命周期过长

### 5. Item 类

**核心功能**：实现游戏中的各种拾取物品及其效果。

#### 主要函数：
- `Item(ItemType type, QGraphicsItem *parent = nullptr)` - 构造函数，设置物品类型
- `loadSprite()` - 根据物品类型加载不同的图像（当前使用绘制的图形代替）
- `update()` - 更新物品状态，实现闪烁和旋转动画，控制生命周期
- `applyEffect(Player *player)` - 对玩家应用物品效果（加血、加弹药等）

### 6. Map 类

**核心功能**：创建游戏地图，绘制背景和障碍物。

#### 主要函数：
- `Map(QGraphicsScene *scene, QGraphicsItem *parent = nullptr)` - 构造函数，设置场景引用
- `loadMap()` - 加载地图资源
- `drawBackground()` - 绘制游戏背景和网格
- `generateObstacles()` - 随机生成地图障碍物

## 二、游戏规则与操作说明

### 操作方法

1. **移动控制**：
   - 使用方向键（↑↓←→）或WASD键控制角色移动
   - 角色移动有边界限制，不会走出游戏窗口

2. **射击控制**：
   - 用鼠标左键点击任意位置进行射击
   - 子弹会沿鼠标点击方向飞行
   - 角色会自动旋转朝向射击方向

3. **游戏退出**：
   - 按ESC键退出游戏

### 游戏规则

1. **基本目标**：
   - 尽可能长时间地生存
   - 消灭敌人获得分数
   - 完成一波又一波的敌人进攻

2. **敌人行为**：
   - 敌人从屏幕边缘随机位置生成
   - 敌人会自动追踪玩家
   - 敌人接触玩家会造成伤害
   - 敌人死亡时有30%概率掉落物品

3. **物品系统**：
   - **血包（红色）**：恢复50点生命值
   - **弹药包（绿色）**：补充30发弹药
   - **速度提升（蓝色）**：当前版本中提供20点生命值
   - 物品会缓慢旋转并闪烁，50秒后消失

4. **波次系统**：
   - 每消灭一波敌人，进入下一波
   - 波次越高，敌人生成速度越快
   - 屏幕左上角显示当前波次数

5. **生命值系统**：
   - 初始生命值为100
   - 生命值降为0时游戏结束
   - 受到伤害时角色会短暂闪烁

6. **弹药系统**：
   - 初始弹药为100发
   - 每次射击消耗1发弹药
   - 弹药耗尽时无法射击

7. **得分系统**：
   - 每消灭一个敌人获得10分
   - 分数显示在屏幕左上角

### 游戏结束

- 当玩家生命值降为0时，游戏结束
- 显示最终分数和达到的波次数
- 按ESC键退出游戏窗口

## 三、扩展建议

如果需要进一步完善游戏，可以考虑以下扩展：

1. 添加实际的图片资源代替绘制的图形
2. 实现更复杂的地图和关卡系统
3. 添加多种类型的敌人，每种有不同的行为模式
4. 增加武器系统，允许玩家切换不同的武器
5. 添加音效和背景音乐
6. 实现存档和排行榜功能
7. 添加技能系统，让玩家可以使用特殊能力
8. 优化碰撞检测，添加更复杂的物理效果